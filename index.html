<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oppdragstjenesten</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: Arial; background: #f0f4f8; margin: 0; padding: 0;}
        header { background: #0077cc; color: white; padding: 20px; text-align: center; }
        main { max-width: 800px; margin: auto; padding: 20px;}
        input, textarea, button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;}
        button { background: #0077cc; color: white; border: none; cursor: pointer; }
        button:hover { background: #005fa3; }
        .oppdrag { background: white; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1);}
        footer { text-align: center; padding: 15px; background: #0077cc; color: white; margin-top: 30px; }
    </style>
</head>
<body>

<header>
    <h1>Oppdragstjenesten</h1>
    <p>Legg ut små oppdrag og gi feedback etter fullføring</p>
</header>

<main>
    <div id="authDiv">
        <h2>Login / Register</h2>
        <input type="email" id="email" placeholder="E-post">
        <input type="password" id="password" placeholder="Passord">
        <button id="loginBtn">Login</button>
        <button id="registerBtn">Register</button>
    </div>

    <div id="appDiv" style="display:none;">
        <button id="logoutBtn">Logout</button>

        <form id="oppdragForm">
            <h2>Legg ut nytt oppdrag</h2>
            <input type="text" id="tittel" placeholder="Oppdrag tittel" required>
            <textarea id="beskrivelse" rows="3" placeholder="Beskrivelse" required></textarea>
            <button type="submit">Legg til oppdrag</button>
        </form>

        <div id="oppdragListe">
            <h2>Tilgjengelige oppdrag</h2>
        </div>
    </div>
</main>

<footer>© 2025 Oppdragstjenesten</footer>

<script>
    // ==== FIREBASE CONFIG ====
// Sett inn din egen Firebase-konfigurasjon her
const firebaseConfig = {
    apiKey: "DIN_API_KEY",
    authDomain: "DIN_AUTH_DOMAIN",
    projectId: "DIN_PROJECT_ID",
    storageBucket: "DIN_STORAGE_BUCKET",
    messagingSenderId: "DIN_MESSAGING_SENDER_ID",
    appId: "DIN_APP_ID"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

// DOM-elementer
const authDiv = document.getElementById('authDiv');
const appDiv = document.getElementById('appDiv');
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const logoutBtn = document.getElementById('logoutBtn');
const oppdragForm = document.getElementById('oppdragForm');
const oppdragListe = document.getElementById('oppdragListe');

// ==== LOGIN / REGISTER ====
registerBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.createUserWithEmailAndPassword(email, password)
        .then(user => console.log("Registrert!", user))
        .catch(err => alert(err.message));
});

loginBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
        .then(user => console.log("Logget inn!", user))
        .catch(err => alert(err.message));
});

logoutBtn.addEventListener('click', () => {
    auth.signOut();
});

// ==== OBSERVE AUTH STATE ====
auth.onAuthStateChanged(user => {
    if(user){
        authDiv.style.display = "none";
        appDiv.style.display = "block";
        loadOppdrag();
    } else {
        authDiv.style.display = "block";
        appDiv.style.display = "none";
    }
});

// ==== ADD OPPDRAG ====
oppdragForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const tittel = document.getElementById('tittel').value;
    const beskrivelse = document.getElementById('beskrivelse').value;
    const brukerId = auth.currentUser.uid;

    db.collection("oppdrag").add({
        tittel,
        beskrivelse,
        brukerId,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(()=>{
        oppdragForm.reset();
    });
});

// ==== LOAD OPPDRAG ====
function loadOppdrag(){
    oppdragListe.innerHTML = "<h2>Tilgjengelige oppdrag</h2>";
    db.collection("oppdrag").orderBy("timestamp","desc").onSnapshot(snapshot=>{
        oppdragListe.innerHTML = "<h2>Tilgjengelige oppdrag</h2>";
        snapshot.forEach(doc=>{
            const data = doc.data();
            const div = document.createElement('div');
            div.classList.add('oppdrag');
            div.innerHTML = `<h3>${data.tittel}</h3>
                             <p>${data.beskrivelse}</p>`;
            if(data.brukerId === auth.currentUser.uid){
                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = "Slett oppdrag";
                deleteBtn.onclick = () => db.collection("oppdrag").doc(doc.id).delete();
                div.appendChild(deleteBtn);
            }
            oppdragListe.appendChild(div);
        });
    });
}
</script>
</body>
</html>
